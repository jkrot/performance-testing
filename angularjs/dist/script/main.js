function appConfig(e){"use strict";e.debugInfoEnabled(!1)}function fileModel(e,r,i){return{restrict:"A",link:function(r,i,s){var t=e(s.fileModel),a=t.assign;"object"!=typeof r.configs?configs=r.configs:(configs.customerConfigs={},configs.customerConfigs.uploader={},configs.customerConfigs.uploader.jpeg=!1,configs.customerConfigs.uploader.mpeg=!1),i.bind("change",function(e){r.$apply(function(){a(r,i[0].files),r.folder=r.parseFolder(r.myFolder,configs)})})}}}function fileCtrl(e,r,i,s,t){function a(e){return/^[\x00-\x7F]*$/.test(e)}function n(e){var r=["x00100020","x00100010","x00100030","x00100040","x00101010","x0020000d","x0020000e","x00080018","x00080020","x00080060","x00081030"],i=[];for(var s in e.elements)if(r.indexOf(s)>-1){var t=e.elements[s];if(t.items)break;if(t.fragments)break;if(t.length<256){var n=e.string(s),l=a(n);l&&void 0!==n&&(i[s]=n)}}return i}e.parseFolder=function(r,i){e.uploaderDisabled="",e.filesParsed=[0,0,0];for(var s=[],t=r.length,a=0;a<t;a++){var n,l=r[a];l.name.endsWith(".DS_Store")?e.filesParsed[2]=e.filesParsed[2]+1:l.name.endsWith("oly")?e.filesParsed[2]=e.filesParsed[2]+1:l.name.endsWith("xmd")?e.filesParsed[2]=e.filesParsed[2]+1:l.type.indexOf("jpeg")>0||l.type.indexOf("jpg")>0?e.filesParsed[2]=e.filesParsed[2]+1:l.type.indexOf("mpeg")>0||l.type.indexOf("mpg")>0||l.type.indexOf("mov")>0||l.type.indexOf("mp4")>0?e.filesParsed[2]=e.filesParsed[2]+1:e.parseFile(l).then(function(r){n=!0,s.push(l),e.parseUpdate()})["catch"](function(e){n=!1})["finally"](function(){n?e.filesParsed[0]=e.filesParsed[0]+1:e.filesParsed[1]=e.filesParsed[1]+1,e.parseUpdate()})}return e.parseUpdate(),s},e.parseFile=function(e){var s,t=i.defer(),a=new FileReader,l=null;a.onload=function(){var e=a.result;a=void 0;var i=new Uint8Array(e);try{var s={omitPrivateAttibutes:!0,untilTag:"x0020000e",maxElementLength:128},o=dicomParser.parseDicom(i,s);l=n(o),t.resolve(l)}catch(f){if("dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."===f)t.reject({message:"Invalid Dicom File","class":"black"});else{var d=null;if("object"==typeof f.exception){var p=f.exception;d=p.exception}else"string"==typeof f.exception?d=f.exception:(r.error(f),d="Unknown Error");t.reject({message:d,"class":"IMred"})}}},a.onerror=function(e){return a=void 0,t.reject(e)};var o=!0;return e.size>4096?(s=o?e:e.size<32768?e:e.slice(0,32768),a.readAsArrayBuffer(s)):t.reject({message:"File to Small","class":"IMblack"}),e=void 0,s=void 0,t.promise},e.parseUpdate=function(){var r={};e.filesParsed[0]>0?r.parsed=e.filesParsed[0]+" DICOM files available for import. <br />":r.parsed="0 DICOM files available for import. <br />",e.filesParsed[1]>0?r.failed=e.filesParsed[1]+" non-conformant DICOM files. <br />":r.failed="",e.filesParsed[2]>0?r.skipped=e.filesParsed[2]+" non-DICOM files skipped. <br />":r.skipped="",totalFilesParsed=e.filesParsed[0]+e.filesParsed[1]+e.filesParsed[2],e.progressBar=s.trustAsHtml('<progress max="'+e.myFolder.length+'" value="'+totalFilesParsed+'"></progress>'),e.parseStatus=s.trustAsHtml(r.parsed+r.failed+r.skipped)}}var app=angular.module("fileSelector",[]);app.config(appConfig),appConfig.$inject=["$compileProvider"],app.directive("fileModel",fileModel),fileModel.$inject=["$parse","$log","$q"],String.prototype.endsWith||(String.prototype.endsWith=function(e,r){var i=this.toString();("number"!=typeof r||!isFinite(r)||Math.floor(r)!==r||r>i.length)&&(r=i.length),r-=e.length;var s=i.indexOf(e,r);return s!==-1&&s===r}),app.controller("fileCtrl",fileCtrl),fileCtrl.$inject=["$scope","$log","$q","$sce","$filter"];